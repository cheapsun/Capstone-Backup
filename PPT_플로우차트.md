# 🎓 캡스톤 프로젝트 데모 발표 - 플로우차트 자료

## AI 기반 여행 경로 추천 Android 앱

---

## 📊 1. 전체 시스템 아키텍처

```
┌─────────────────────────────────────────────────────────────────┐
│                         사용자 인터페이스                         │
│                      (Jetpack Compose)                          │
└─────────────────────────────────────────────────────────────────┘
                                ↓
┌─────────────────────────────────────────────────────────────────┐
│                    UI Layer (Composables)                       │
│  ┌──────────┐  ┌──────────┐  ┌──────────┐  ┌──────────┐       │
│  │ Main     │  │ Result   │  │RouteList │  │ Route    │       │
│  │ Screen   │  │ Screen   │  │ Screen   │  │ Detail   │       │
│  └──────────┘  └──────────┘  └──────────┘  └──────────┘       │
└─────────────────────────────────────────────────────────────────┘
                                ↓
┌─────────────────────────────────────────────────────────────────┐
│                    ViewModel Layer                              │
│  ┌─────────────────────┐    ┌──────────────────┐              │
│  │   MainViewModel     │    │ ResultViewModel  │              │
│  │ - 상태 관리          │    │ - 경로 상태      │              │
│  │ - 필터 관리          │    │ - 선택 관리      │              │
│  └─────────────────────┘    └──────────────────┘              │
└─────────────────────────────────────────────────────────────────┘
                                ↓
┌─────────────────────────────────────────────────────────────────┐
│                    Repository Layer                             │
│              ┌──────────────────────────┐                       │
│              │ RealTravelRepository     │                       │
│              │ - 비즈니스 로직 통합     │                       │
│              └──────────────────────────┘                       │
└─────────────────────────────────────────────────────────────────┘
                                ↓
┌─────────────────────────────────────────────────────────────────┐
│                    Service Layer (API)                          │
│  ┌─────────┐ ┌─────────┐ ┌─────────┐ ┌─────────┐ ┌─────────┐ │
│  │ Kakao   │ │ OpenAI  │ │ T-Map   │ │ Weather │ │ Storage │ │
│  │ Local   │ │ GPT     │ │Pedestri │ │ API     │ │(Local)  │ │
│  └─────────┘ └─────────┘ └─────────┘ └─────────┘ └─────────┘ │
└─────────────────────────────────────────────────────────────────┘
                                ↓
┌─────────────────────────────────────────────────────────────────┐
│                      External Services                          │
│   Kakao API  │  OpenAI API  │  T-Map API  │  OpenWeather API   │
└─────────────────────────────────────────────────────────────────┘
```

### 주요 기술 스택
- **Frontend**: Kotlin + Jetpack Compose
- **Architecture**: MVVM + Repository Pattern
- **Async**: Kotlin Coroutines + Flow
- **Network**: Retrofit2 + OkHttp3
- **Map**: Kakao Maps SDK 2.9.5
- **Storage**: SharedPreferences (JSON)

---

## 🚶 2. 전체 사용자 여정 플로우

```
                        ┌─────────────────┐
                        │   앱 실행       │
                        │  (MainActivity)  │
                        └────────┬────────┘
                                 │
                                 ↓
                        ┌─────────────────┐
                        │  위치 권한 요청  │
                        │   (GPS 권한)    │
                        └────────┬────────┘
                                 │
                                 ↓
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┓
┃                    STEP 1: 검색 조건 입력                     ┃
┃                      (MainScreen)                            ┃
┗━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┛
                        ┌─────────────────┐
                        │  필터 입력 폼    │
                        ├─────────────────┤
                        │ ✓ 지역 (광주)   │
                        │ ✓ 카테고리      │
                        │   (맛집, 카페)  │
                        │ ✓ 기간 (하루)   │
                        │ ✓ 예산 (5만원)  │
                        │ ✓ 동행 (친구)   │
                        └────────┬────────┘
                                 │
                                 ↓
                   ┌─────────────────────────┐
                   │ "맞춤 루트 생성 (AI)" 버튼│
                   └───────────┬─────────────┘
                               │
                               ↓
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┓
┃                 STEP 2: AI 추천 엔진 작동                     ┃
┃                  (백그라운드 처리)                            ┃
┗━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┛
                ┌──────────────────────────┐
                │ 1. Kakao Local API       │
                │    장소 검색 (15개/카테고리)│
                └───────────┬──────────────┘
                            │
                            ↓
                ┌──────────────────────────┐
                │ 2. OpenWeather API       │
                │    현재 날씨 조회         │
                └───────────┬──────────────┘
                            │
                            ↓
                ┌──────────────────────────┐
                │ 3. OpenAI GPT API        │
                │    재랭킹 + 추천 이유     │
                │    (사용자 선호도 반영)   │
                └───────────┬──────────────┘
                            │
                            ↓
                ┌──────────────────────────┐
                │ 4. 결과 병합 및 정렬      │
                │    - 카테고리별 Top 1     │
                │    - AI 점수 순 정렬     │
                └───────────┬──────────────┘
                            │
                            ↓
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┓
┃               STEP 3: 추천 결과 표시 (지도)                   ┃
┃                    (ResultScreen)                            ┃
┗━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┛
                        ┌─────────────────┐
                        │  Kakao 지도 표시 │
                        ├─────────────────┤
                        │ • 추천 장소 핀   │
                        │ • 날씨 정보      │
                        │ • Top Picks 뱃지 │
                        │ • AI 추천 이유   │
                        └────────┬────────┘
                                 │
                                 ↓
                        ┌─────────────────┐
                        │ 사용자 장소 선택 │
                        │ (핀 탭 + 번호 지정)│
                        └────────┬────────┘
                                 │
                                 ↓
                        ┌─────────────────┐
                        │ 드래그 & 드롭    │
                        │ (순서 변경)      │
                        └────────┬────────┘
                                 │
                                 ↓
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┓
┃                  STEP 4: 경로 생성                           ┃
┗━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┛
                ┌──────────────────────────┐
                │ "루트 생성하기" 버튼 클릭  │
                └───────────┬──────────────┘
                            │
                            ↓
                ┌──────────────────────────┐
                │ T-Map Pedestrian API     │
                │ - 보행자 경로 계산        │
                │ - 구간별 거리/시간        │
                └───────────┬──────────────┘
                            │
                            ↓
                ┌──────────────────────────┐
                │ 지도 시각화               │
                │ - 다색상 폴리라인         │
                │ - 시작/도착 핀           │
                │ - 번호 마커              │
                └───────────┬──────────────┘
                            │
                            ↓
                ┌──────────────────────────┐
                │ 경로 정보 표시            │
                │ - 총 거리: 5.2km         │
                │ - 총 시간: 1시간 12분    │
                │ - 구간별 상세             │
                └───────────┬──────────────┘
                            │
                            ↓
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┓
┃                   STEP 5: 루트 저장                          ┃
┗━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┛
                        ┌─────────────────┐
                        │ "루트 저장" 클릭 │
                        └────────┬────────┘
                                 │
                                 ↓
                        ┌─────────────────┐
                        │ 루트 이름 입력   │
                        │ (다이얼로그)     │
                        └────────┬────────┘
                                 │
                                 ↓
                        ┌─────────────────┐
                        │ SharedPreferences│
                        │ JSON 저장        │
                        └────────┬────────┘
                                 │
                                 ↓
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┓
┃                STEP 6: 저장된 루트 관리                       ┃
┃                  (RouteListScreen)                           ┃
┗━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┛
                        ┌─────────────────┐
                        │ 루트 목록 표시   │
                        └────────┬────────┘
                                 │
                    ┌────────────┼────────────┐
                    ↓                         ↓
           ┌─────────────────┐      ┌─────────────────┐
           │ 루트 클릭        │      │ 길게 누르기      │
           │ (상세보기)       │      │ (삭제)          │
           └────────┬────────┘      └─────────────────┘
                    │
                    ↓
           ┌─────────────────┐
           │RouteDetailScreen│
           │- 장소 순서 편집  │
           │- 지도로 보기     │
           └────────┬────────┘
                    │
                    ↓
           ┌─────────────────┐
           │ RouteMapScreen  │
           │- 경로 재표시     │
           │- 구간 클릭 강조  │
           └─────────────────┘
```

### 사용자 여정 핵심 포인트
- **3번의 클릭만으로** 개인화된 여행 경로 생성
- **AI가 자동으로** 날씨, 선호도, 예산 고려
- **실제 보행자 경로** 기반 정확한 시간/거리 계산
- **저장 후 재사용** 가능한 루트 관리

---

## 🤖 3. AI 추천 알고리즘 상세 플로우

```
                    ┌──────────────────────┐
                    │  사용자 필터 입력     │
                    │ (지역, 카테고리, 예산) │
                    └──────────┬───────────┘
                               │
                               ↓
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┓
┃               PHASE 1: Kakao Local 장소 수집                 ┃
┗━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┛
                    ┌──────────────────────┐
                    │ 1. 지역명 → 좌표 변환 │
                    │   (Geocoding API)    │
                    │   "광주" → (35.1, 126.9)│
                    └──────────┬───────────┘
                               │
                               ↓
                    ┌──────────────────────┐
                    │ 2. 카테고리별 병렬 검색│
                    └──────────┬───────────┘
                               │
        ┌──────────────────────┼──────────────────────┐
        ↓                      ↓                      ↓
┌───────────────┐    ┌───────────────┐    ┌───────────────┐
│ 카테고리: 맛집 │    │ 카테고리: 카페 │    │ 카테고리: 문화 │
├───────────────┤    ├───────────────┤    ├───────────────┤
│• 검색 반경: 2km│    │• 검색 반경: 2km│    │• 검색 반경: 2km│
│• 최대: 15개    │    │• 최대: 15개    │    │• 최대: 15개    │
│• 평점순 정렬   │    │• 평점순 정렬   │    │• 평점순 정렬   │
└───────┬───────┘    └───────┬───────┘    └───────┬───────┘
        │                    │                    │
        └────────────────────┴────────────────────┘
                             │
                             ↓
                    ┌──────────────────────┐
                    │ 3. 결과 병합          │
                    │ - 중복 제거           │
                    │ - 총 30~50개 수집     │
                    └──────────┬───────────┘
                               │
                               ↓
                    ┌──────────────────────┐
                    │ 4. 카테고리 리밸런싱  │
                    │ - 각 카테고리 최소 4개│
                    │ - 비율 자동 조정      │
                    └──────────┬───────────┘
                               │
                               ↓
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┓
┃              PHASE 2: OpenWeather 날씨 조회                  ┃
┗━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┛
                    ┌──────────────────────┐
                    │ 현재 날씨 API 호출    │
                    │ - 기온: 22°C         │
                    │ - 상태: 맑음          │
                    │ - 습도: 65%          │
                    └──────────┬───────────┘
                               │
                               ↓
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┓
┃                PHASE 3: GPT AI 재랭킹                        ┃
┗━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┛
                    ┌──────────────────────┐
                    │ 프롬프트 구성         │
                    ├──────────────────────┤
                    │ • 사용자 정보:        │
                    │   - 예산: 5만원       │
                    │   - 동행: 친구        │
                    │   - 기간: 하루        │
                    │   - 선호: 맛집, 카페  │
                    │                      │
                    │ • 컨텍스트:          │
                    │   - 날씨: 맑음, 22°C │
                    │   - 시간: 오후        │
                    │                      │
                    │ • 후보 장소 리스트:   │
                    │   [30~50개 장소 정보]│
                    └──────────┬───────────┘
                               │
                               ↓
                    ┌──────────────────────┐
                    │ OpenAI GPT-4 API     │
                    │ (JSON Mode)          │
                    └──────────┬───────────┘
                               │
                               ↓
                    ┌──────────────────────┐
                    │ GPT 응답 파싱         │
                    ├──────────────────────┤
                    │ {                    │
                    │   places: [          │
                    │     {                │
                    │       id: "xxx",     │
                    │       rank: 1,       │
                    │       score: 95,     │
                    │       reason: "날씨가│
                    │       좋아 야외 테라스│
                    │       추천..."       │
                    │     },               │
                    │     ...              │
                    │   ]                  │
                    │ }                    │
                    └──────────┬───────────┘
                               │
                               ↓
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┓
┃               PHASE 4: 최종 결과 생성                        ┃
┗━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┛
                    ┌──────────────────────┐
                    │ 1. GPT 순서 적용      │
                    │    (AI 점수 기반)     │
                    └──────────┬───────────┘
                               │
                               ↓
                    ┌──────────────────────┐
                    │ 2. 체인점 패널티      │
                    │    (스타벅스 등 하향) │
                    └──────────┬───────────┘
                               │
                               ↓
                    ┌──────────────────────┐
                    │ 3. Top Picks 선정     │
                    │    (카테고리별 1위)   │
                    └──────────┬───────────┘
                               │
                               ↓
                    ┌──────────────────────┐
                    │ 4. AI 뱃지 지정       │
                    │    (Top 3 장소)      │
                    └──────────┬───────────┘
                               │
                               ↓
                    ┌──────────────────────┐
                    │ RecommendationResult │
                    │ - places: 15~20개    │
                    │ - weather: 날씨 정보  │
                    │ - gptReasons: 이유 맵│
                    │ - topPicks: 상위 장소│
                    └──────────┬───────────┘
                               │
                               ↓
                    ┌──────────────────────┐
                    │   UI에 결과 표시      │
                    └──────────────────────┘
```

### AI 추천 핵심 알고리즘
1. **2단계 필터링**: Kakao 기본 검색 → GPT 스마트 재랭킹
2. **날씨 통합**: 실시간 날씨에 맞는 장소 우선순위
3. **예산 고려**: 사용자 예산 범위 내 장소 추천
4. **다양성 보장**: 카테고리별 최소 개수 보장
5. **설명 생성**: 각 장소별 추천 이유 AI 자동 생성

---

## 🗺️ 4. 경로 생성 및 시각화 플로우

```
                    ┌──────────────────────┐
                    │ 추천 결과 지도 표시   │
                    │ (ResultScreen)       │
                    └──────────┬───────────┘
                               │
                               ↓
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┓
┃                 STEP 1: 장소 선택                            ┃
┗━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┛
                    ┌──────────────────────┐
                    │ 사용자가 핀 클릭      │
                    └──────────┬───────────┘
                               │
                               ↓
                    ┌──────────────────────┐
                    │ selectedPlaces에 추가 │
                    │ - 선택 순서 번호 부여 │
                    │ - 마커 색상 변경      │
                    └──────────┬───────────┘
                               │
                               ↓
                    ┌──────────────────────┐
                    │ 하단 선택 리스트 표시 │
                    ├──────────────────────┤
                    │ 1. 광주 카페 거리     │
                    │ 2. 양림동 펭귄마을    │
                    │ 3. 국립아시아문화전당 │
                    │ 4. 무등산 입구        │
                    └──────────┬───────────┘
                               │
                               ↓
                    ┌──────────────────────┐
                    │ 드래그 & 드롭 가능    │
                    │ (순서 재배치)         │
                    └──────────┬───────────┘
                               │
                               ↓
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┓
┃              STEP 2: T-Map 경로 계산                         ┃
┗━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┛
                    ┌──────────────────────┐
                    │ "루트 생성" 버튼 클릭 │
                    └──────────┬───────────┘
                               │
                               ↓
                    ┌──────────────────────┐
                    │ getFullRoute() 호출   │
                    └──────────┬───────────┘
                               │
                    ┌──────────┴───────────┐
                    │ 구간별 병렬 API 호출  │
                    └──────────┬───────────┘
                               │
        ┌──────────────────────┼──────────────────────┐
        ↓                      ↓                      ↓
┌───────────────┐    ┌───────────────┐    ┌───────────────┐
│  구간 1       │    │  구간 2       │    │  구간 3       │
│ A → B         │    │ B → C         │    │ C → D         │
├───────────────┤    ├───────────────┤    ├───────────────┤
│T-Map POST API │    │T-Map POST API │    │T-Map POST API │
│{              │    │{              │    │{              │
│ startX: 126.9 │    │ startX: 126.9 │    │ startX: 127.0 │
│ startY: 35.1  │    │ startY: 35.2  │    │ startY: 35.3  │
│ endX: 126.92  │    │ endX: 127.0   │    │ endX: 127.1   │
│ endY: 35.2    │    │ endY: 35.3    │    │ endY: 35.4    │
│ searchOption:0│    │ searchOption:0│    │ searchOption:0│
│}              │    │}              │    │}              │
└───────┬───────┘    └───────┬───────┘    └───────┬───────┘
        │                    │                    │
        └────────────────────┴────────────────────┘
                             │
                             ↓
                    ┌──────────────────────┐
                    │ 응답 파싱             │
                    ├──────────────────────┤
                    │ features[].geometry  │
                    │ .coordinates[]       │
                    │ → LatLng 리스트 변환  │
                    │                      │
                    │ properties:          │
                    │ - totalDistance: 850m│
                    │ - totalTime: 12분    │
                    └──────────┬───────────┘
                               │
                               ↓
                    ┌──────────────────────┐
                    │ RouteSegment 생성     │
                    ├──────────────────────┤
                    │ from: Place A        │
                    │ to: Place B          │
                    │ pathCoordinates: [   │
                    │   LatLng(35.1, 126.9)│
                    │   LatLng(35.11, 126.9)│
                    │   ...                │
                    │ ]                    │
                    │ distanceMeters: 850  │
                    │ durationSeconds: 720 │
                    └──────────┬───────────┘
                               │
                               ↓
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┓
┃               STEP 3: 지도 시각화                            ┃
┗━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┛
                    ┌──────────────────────┐
                    │ RouteLineManager     │
                    │ .updateRoute()       │
                    └──────────┬───────────┘
                               │
        ┌──────────────────────┼──────────────────────┐
        ↓                      ↓                      ↓
┌───────────────┐    ┌───────────────┐    ┌───────────────┐
│ 구간 1 렌더링  │    │ 구간 2 렌더링  │    │ 구간 3 렌더링  │
├───────────────┤    ├───────────────┤    ├───────────────┤
│ 색상: 파란색   │    │ 색상: 초록색   │    │ 색상: 노란색   │
│ 두께: 8dp     │    │ 두께: 8dp     │    │ 두께: 8dp     │
│ 폴리라인 생성  │    │ 폴리라인 생성  │    │ 폴리라인 생성  │
└───────────────┘    └───────────────┘    └───────────────┘
                               │
                               ↓
                    ┌──────────────────────┐
                    │ 마커 추가             │
                    ├──────────────────────┤
                    │ • 시작점: 초록 핀     │
                    │ • 도착점: 빨간 핀     │
                    │ • 중간점: 번호 마커   │
                    └──────────┬───────────┘
                               │
                               ↓
                    ┌──────────────────────┐
                    │ 카메라 자동 조정      │
                    │ - 전체 경로 보이게    │
                    │ - 적절한 줌 레벨      │
                    └──────────┬───────────┘
                               │
                               ↓
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┓
┃               STEP 4: 경로 정보 표시                         ┃
┗━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┛
                    ┌──────────────────────┐
                    │ 경로 요약 카드        │
                    ├──────────────────────┤
                    │ 총 거리: 5.2km       │
                    │ 총 시간: 1시간 12분   │
                    │ 선택 장소: 4개        │
                    └──────────┬───────────┘
                               │
                               ↓
                    ┌──────────────────────┐
                    │ 구간별 상세 정보      │
                    ├──────────────────────┤
                    │ 1→2: 광주 카페거리   │
                    │      → 양림동 펭귄마을│
                    │      850m / 12분     │
                    │                      │
                    │ 2→3: 양림동 펭귄마을 │
                    │      → 국립아시아문화│
                    │      1.2km / 18분    │
                    │                      │
                    │ 3→4: 국립아시아문화  │
                    │      → 무등산 입구    │
                    │      3.1km / 42분    │
                    └──────────┬───────────┘
                               │
                               ↓
                    ┌──────────────────────┐
                    │ "루트 저장" 버튼 표시 │
                    └──────────────────────┘
```

### 경로 생성 핵심 기술
- **T-Map Pedestrian API**: 실제 보행자 도로 기반 경로
- **구간별 색상 구분**: 6가지 색상 순환 (파랑→초록→노랑→빨강→보라→주황)
- **드래그 드롭**: Reorderable 라이브러리로 순서 변경
- **실시간 재계산**: 순서 변경 시 경로 즉시 업데이트
- **정확한 시간/거리**: GPS 좌표 기반 실제 도로 거리

---

## 💾 5. 데이터 저장 및 관리 플로우

```
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┓
┃                    루트 저장 프로세스                         ┃
┗━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┛
                    ┌──────────────────────┐
                    │ "루트 저장" 버튼 클릭 │
                    └──────────┬───────────┘
                               │
                               ↓
                    ┌──────────────────────┐
                    │ 이름 입력 다이얼로그  │
                    │ "광주 하루 여행"      │
                    └──────────┬───────────┘
                               │
                               ↓
                    ┌──────────────────────┐
                    │ SavedRoute 객체 생성  │
                    ├──────────────────────┤
                    │ id: timestamp        │
                    │ name: "광주 하루 여행"│
                    │ places: [4개 장소]   │
                    │ routeSegments: [3개] │
                    │ totalDistance: 5200m │
                    │ totalDuration: 4320s │
                    │ createdAt: 173165... │
                    └──────────┬───────────┘
                               │
                               ↓
                    ┌──────────────────────┐
                    │ Gson.toJson()        │
                    │ 객체 → JSON 문자열    │
                    └──────────┬───────────┘
                               │
                               ↓
                    ┌──────────────────────┐
                    │ SharedPreferences    │
                    │ .edit()              │
                    │ .putString()         │
                    │ .apply()             │
                    └──────────┬───────────┘
                               │
                               ↓
                    ┌──────────────────────┐
                    │ 저장 완료 토스트      │
                    │ "루트가 저장되었습니다"│
                    └──────────────────────┘

┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┓
┃                    루트 조회 프로세스                         ┃
┗━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┛
                    ┌──────────────────────┐
                    │ RouteListScreen 진입  │
                    └──────────┬───────────┘
                               │
                               ↓
                    ┌──────────────────────┐
                    │ RouteStorage         │
                    │ .getAllRoutes()      │
                    └──────────┬───────────┘
                               │
                               ↓
                    ┌──────────────────────┐
                    │ SharedPreferences    │
                    │ .getAll()            │
                    └──────────┬───────────┘
                               │
                               ↓
                    ┌──────────────────────┐
                    │ JSON → 객체 변환      │
                    │ Gson.fromJson()      │
                    └──────────┬───────────┘
                               │
                               ↓
                    ┌──────────────────────┐
                    │ List<SavedRoute>     │
                    │ 시간순 정렬           │
                    └──────────┬───────────┘
                               │
                               ↓
                    ┌──────────────────────┐
                    │ UI 리스트 렌더링      │
                    ├──────────────────────┤
                    │ [카드 1]             │
                    │ 광주 하루 여행        │
                    │ 5.2km · 1시간 12분   │
                    │ 2024-11-15           │
                    │                      │
                    │ [카드 2]             │
                    │ 서울 감성 투어        │
                    │ 3.8km · 52분         │
                    │ 2024-11-10           │
                    └──────────┬───────────┘
                               │
                    ┌──────────┴───────────┐
                    ↓                      ↓
           ┌─────────────────┐    ┌─────────────────┐
           │ 카드 클릭        │    │ 길게 누르기      │
           └────────┬────────┘    └────────┬────────┘
                    │                      │
                    ↓                      ↓
           ┌─────────────────┐    ┌─────────────────┐
           │RouteDetailScreen│    │ 삭제 확인 다이얼로그│
           └─────────────────┘    └────────┬────────┘
                                            │
                                            ↓
                                   ┌─────────────────┐
                                   │ RouteStorage    │
                                   │ .deleteRoute()  │
                                   └────────┬────────┘
                                            │
                                            ↓
                                   ┌─────────────────┐
                                   │SharedPreferences│
                                   │ .remove(key)    │
                                   └─────────────────┘

┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┓
┃                  루트 편집 및 재생성                         ┃
┗━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┛
                    ┌──────────────────────┐
                    │ RouteDetailScreen    │
                    │ (편집 모드)           │
                    └──────────┬───────────┘
                               │
                               ↓
                    ┌──────────────────────┐
                    │ 장소 순서 드래그      │
                    │ 1↔3 위치 변경        │
                    └──────────┬───────────┘
                               │
                               ↓
                    ┌──────────────────────┐
                    │ T-Map API 재호출      │
                    │ (새 순서로 경로 계산) │
                    └──────────┬───────────┘
                               │
                               ↓
                    ┌──────────────────────┐
                    │ 경로 정보 업데이트    │
                    │ - 새 거리: 4.8km     │
                    │ - 새 시간: 1시간 5분 │
                    └──────────┬───────────┘
                               │
                               ↓
                    ┌──────────────────────┐
                    │ "저장" 버튼 클릭      │
                    │ (기존 루트 덮어쓰기)  │
                    └──────────────────────┘
```

### 데이터 저장 핵심 기술
- **SharedPreferences**: 간단한 로컬 저장소
- **Gson**: JSON 직렬화/역직렬화
- **Key-Value 구조**: route_{timestamp} 형태로 저장
- **CRUD 완성**: Create, Read, Update, Delete 모두 구현

---

## 🔗 6. API 통합 다이어그램

```
┌─────────────────────────────────────────────────────────────────┐
│                        Android 앱                               │
│                    (Kotlin + Compose)                           │
└─────────────────────────────────────────────────────────────────┘
                                │
                ┌───────────────┼───────────────┐
                ↓               ↓               ↓
┌─────────────────────┐ ┌─────────────┐ ┌──────────────┐
│   Retrofit2 Client  │ │ Kakao SDK   │ │Google Play   │
│   (REST API)        │ │ (Native)    │ │Services      │
└─────────────────────┘ └─────────────┘ └──────────────┘
         │                      │                │
         │                      │                └─────────────┐
         │                      │                              ↓
         │                      │                    ┌──────────────────┐
         │                      │                    │  GPS Location    │
         │                      │                    │  - 현재 위치      │
         │                      │                    │  - 위치 권한      │
         │                      │                    └──────────────────┘
         │                      │
         │                      ↓
         │            ┌──────────────────┐
         │            │ Kakao Maps SDK   │
         │            │ https://apis-navi│
         │            │ .kakaomobility.  │
         │            │ com/             │
         │            ├──────────────────┤
         │            │ • 지도 렌더링     │
         │            │ • 마커 표시       │
         │            │ • 폴리라인        │
         │            │ • 카메라 제어     │
         │            └──────────────────┘
         │
    ┌────┴────┬─────────┬────────────┬──────────────┐
    ↓         ↓         ↓            ↓              ↓
┌────────┐┌────────┐┌────────┐┌────────────┐┌──────────┐
│ Kakao  ││ OpenAI ││ T-Map  ││OpenWeather ││  (확장)  │
│ Local  ││  GPT   ││Pedestri││    API     ││  Naver   │
│  API   ││  API   ││an API  ││            ││  등      │
└────────┘└────────┘└────────┘└────────────┘└──────────┘
    │         │         │            │
    │         │         │            │
    ↓         ↓         ↓            ↓

┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┓
┃                    API 1: Kakao Local                        ┃
┗━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┛
    Endpoint: https://dapi.kakao.com/v2/local/

    [사용 API]
    • GET /search/address.json
      - 기능: 지역명 → 좌표 변환 (Geocoding)
      - 입력: query="광주광역시"
      - 출력: lat=35.1595, lng=126.8526

    • GET /search/category.json
      - 기능: 카테고리별 장소 검색
      - 입력: category_group_code=FD6 (음식점)
              x=126.8526, y=35.1595, radius=2000
      - 출력: 장소 리스트 (최대 15개)

    • GET /search/keyword.json
      - 기능: 키워드 검색
      - 입력: query="카페", x=126.8526, y=35.1595
      - 출력: 장소 리스트

    [인증 방식]
    Header: Authorization: KakaoAK {REST_API_KEY}

    [응답 예시]
    {
      "documents": [
        {
          "id": "12345",
          "place_name": "광주 카페거리",
          "category_name": "음식점 > 카페",
          "x": "126.8526",
          "y": "35.1595",
          "distance": "450"
        }
      ]
    }

┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┓
┃                   API 2: OpenAI GPT-4                        ┃
┗━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┛
    Endpoint: https://api.openai.com/v1/chat/completions

    [요청 구조]
    POST /v1/chat/completions
    Header: Authorization: Bearer {OPENAI_API_KEY}
    Body: {
      "model": "gpt-4-turbo-preview",
      "messages": [
        {
          "role": "system",
          "content": "여행 추천 전문가..."
        },
        {
          "role": "user",
          "content": "사용자: 친구와 광주 여행, 예산 5만원..."
        }
      ],
      "response_format": { "type": "json_object" },
      "temperature": 0.7
    }

    [응답 예시]
    {
      "choices": [
        {
          "message": {
            "content": "{
              \"places\": [
                {
                  \"id\": \"12345\",
                  \"rank\": 1,
                  \"score\": 95,
                  \"reason\": \"날씨가 좋아 야외 테라스 추천\"
                }
              ]
            }"
          }
        }
      ]
    }

    [특징]
    • JSON Mode로 구조화된 응답
    • 사용자 컨텍스트 통합 (날씨, 예산, 선호도)
    • 추천 이유 자동 생성

┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┓
┃                API 3: T-Map Pedestrian                       ┃
┗━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┛
    Endpoint: https://apis.openapi.sk.com/tmap/routes/pedestrian

    [요청 구조]
    POST /routes/pedestrian?version=1
    Header: appKey: {TMAP_API_KEY}
    Body: {
      "startX": "126.8526",
      "startY": "35.1595",
      "endX": "126.8626",
      "endY": "35.1695",
      "startName": "출발지",
      "endName": "도착지",
      "searchOption": "0"  // 0: 추천, 10: 최단거리
    }

    [응답 구조]
    {
      "type": "FeatureCollection",
      "features": [
        {
          "type": "Feature",
          "geometry": {
            "type": "LineString",
            "coordinates": [
              [126.8526, 35.1595],
              [126.8530, 35.1600],
              ...
            ]
          },
          "properties": {
            "totalDistance": 850,      // 미터
            "totalTime": 720,          // 초
            "index": 0,
            "name": "구간명"
          }
        }
      ]
    }

    [특징]
    • 실제 보행자 도로 기반 경로
    • GeoJSON 형식 응답
    • 상세 턴바이턴 정보

┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┓
┃                API 4: OpenWeather API                        ┃
┗━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┛
    Endpoint: https://api.openweathermap.org/data/2.5/weather

    [요청 구조]
    GET /data/2.5/weather?lat=35.1595&lon=126.8526&appid={API_KEY}&units=metric&lang=kr

    [응답 예시]
    {
      "main": {
        "temp": 22.5,
        "feels_like": 21.8,
        "humidity": 65
      },
      "weather": [
        {
          "main": "Clouds",
          "description": "구름조금",
          "icon": "02d"
        }
      ],
      "wind": {
        "speed": 3.5
      }
    }

    [특징]
    • 실시간 날씨 정보
    • 좌표 기반 조회
    • 한국어 지원

┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┓
┃                  API 통합 타이밍 차트                         ┃
┗━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┛

사용자 "맞춤 루트 생성" 클릭
    │
    ├─[0초] Kakao Geocoding API (지역 → 좌표)
    │   └─ 응답 시간: ~200ms
    │
    ├─[0.2초] 병렬 실행:
    │   ├─ Kakao Category API (맛집, 카페, 문화 등)
    │   │   └─ 응답 시간: ~500ms
    │   │
    │   └─ OpenWeather API (날씨 조회)
    │       └─ 응답 시간: ~300ms
    │
    ├─[0.7초] OpenAI GPT API (재랭킹)
    │   └─ 응답 시간: ~3초 (가장 느림)
    │
    └─[3.7초] 최종 결과 표시 (ResultScreen)

사용자 "루트 생성" 클릭
    │
    ├─[0초] T-Map Pedestrian API (구간별 병렬 호출)
    │   ├─ 구간 1: ~800ms
    │   ├─ 구간 2: ~800ms
    │   └─ 구간 3: ~800ms
    │
    └─[0.8초] 지도 렌더링 완료

총 소요 시간: 약 4.5초 (AI 추천) + 1초 (경로 생성)
```

### API 통합 핵심 포인트
- **5개 외부 API 통합**: Kakao, OpenAI, T-Map, OpenWeather, Google
- **병렬 처리**: 독립적인 API는 동시 호출로 성능 최적화
- **에러 핸들링**: 각 API별 타임아웃 및 재시도 로직
- **인증 관리**: BuildConfig로 API 키 안전하게 관리

---

## 📱 7. 화면 전환 네비게이션 맵

```
                        ┌─────────────────┐
                        │  MainActivity   │
                        │  (앱 진입점)     │
                        └────────┬────────┘
                                 │
                                 ↓
                    ┌────────────────────────┐
                    │  Bottom Navigation Bar │
                    │  (항상 표시)            │
                    └────────────────────────┘
                         │      │      │
            ┌────────────┼──────┼──────┼────────────┐
            │            │      │      │            │
            ↓            ↓      ↓      ↓            ↓
      ┌─────────┐  ┌─────────┐  ┌─────────┐  ┌─────────┐
      │ 검색 탭  │  │ 지도 탭  │  │ 루트 탭  │  │(확장용) │
      └─────────┘  └─────────┘  └─────────┘  └─────────┘
            │            │            │
            ↓            ↓            ↓
┌────────────────┐┌────────────────┐┌────────────────┐
│  MainScreen    ││ ResultScreen   ││RouteListScreen │
│                ││                ││                │
│ [필터 폼]      ││ [Kakao 지도]   ││ [저장 루트 목록]│
│ - 지역         ││ - 추천 핀      ││                │
│ - 카테고리     ││ - 선택 리스트  ││ [루트 카드 1]  │
│ - 기간         ││ - 경로 선      ││ [루트 카드 2]  │
│ - 예산         ││ - 날씨 정보    ││ [루트 카드 3]  │
│ - 동행         ││                ││                │
│                ││ [하단 시트]    ││                │
│ [생성 버튼]────┼→[장소 선택]    ││                │
│                ││ [루트 생성]    ││                │
│                ││ [루트 저장]    ││                │
└────────────────┘└────────────────┘└────────┬───────┘
                                             │
                                             │ (카드 클릭)
                                             ↓
                                  ┌────────────────────┐
                                  │ RouteDetailScreen  │
                                  │                    │
                                  │ [루트 정보 헤더]    │
                                  │ - 이름              │
                                  │ - 총 거리/시간      │
                                  │ - 생성 날짜         │
                                  │                    │
                                  │ [장소 리스트]       │
                                  │ (드래그 가능)       │
                                  │ 1. 장소 A          │
                                  │ 2. 장소 B          │
                                  │ 3. 장소 C          │
                                  │                    │
                                  │ [구간 정보]         │
                                  │ A→B: 850m, 12분    │
                                  │ B→C: 1.2km, 18분   │
                                  │                    │
                                  │ [지도로 보기 버튼]──┐
                                  │ [삭제 버튼]         │
                                  └─────────────────────┘
                                                        │
                                                        ↓
                                          ┌──────────────────────┐
                                          │  RouteMapScreen      │
                                          │                      │
                                          │  [전체 화면 지도]     │
                                          │  - 저장된 경로 표시   │
                                          │  - 구간별 색상 구분   │
                                          │  - 마커 표시          │
                                          │                      │
                                          │  [하단 타임라인]      │
                                          │  ├ 장소 1            │
                                          │  ├─ 850m, 12분       │
                                          │  ├ 장소 2            │
                                          │  ├─ 1.2km, 18분      │
                                          │  └ 장소 3            │
                                          │                      │
                                          │  [뒤로가기 버튼]      │
                                          └──────────────────────┘

┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┓
┃                    화면 전환 규칙                           ┃
┗━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┛

1. MainScreen → ResultScreen
   - 트리거: "맞춤 루트 생성" 버튼 클릭
   - 애니메이션: 탭 전환 (슬라이드)
   - 데이터 전달: RecommendationResult (ViewModel 공유)

2. ResultScreen 내 모달
   - 트리거: "루트 저장" 버튼 클릭
   - 애니메이션: 바텀 시트 슬라이드 업
   - 데이터 전달: SavedRoute

3. RouteListScreen → RouteDetailScreen
   - 트리거: 루트 카드 클릭
   - 애니메이션: 오른쪽에서 슬라이드 인
   - 데이터 전달: routeId (Navigation Arguments)

4. RouteDetailScreen → RouteMapScreen
   - 트리거: "지도로 보기" 버튼 클릭
   - 애니메이션: 페이드 인
   - 데이터 전달: routeId

5. 뒤로 가기 동작
   - RouteMapScreen → RouteDetailScreen (백스택)
   - RouteDetailScreen → RouteListScreen (백스택)
   - 바텀 네비게이션 탭 전환 시 각 탭의 루트 화면 유지
```

### 네비게이션 핵심 기술
- **Jetpack Navigation Compose**: 타입 안전 네비게이션
- **Bottom Navigation**: 3개 주요 탭
- **백스택 관리**: 사용자 경험 최적화
- **상태 보존**: 탭 전환 시 화면 상태 유지

---

## 🎯 8. 핵심 기술 하이라이트

```
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┓
┃              1. MVVM 아키텍처 패턴                          ┃
┗━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┛

[View Layer] - Jetpack Compose
    ↓ (사용자 이벤트)
[ViewModel Layer] - StateFlow로 상태 관리
    ↓ (비즈니스 로직 호출)
[Repository Layer] - 데이터 소스 통합
    ↓ (API 호출)
[Service Layer] - 외부 API 통신

장점:
✓ 테스트 가능성 향상
✓ 관심사 분리 (Separation of Concerns)
✓ UI와 비즈니스 로직 독립성


┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┓
┃              2. Kotlin Coroutines 비동기 처리               ┃
┗━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┛

// ViewModel에서 비동기 작업
viewModelScope.launch {
    _loading.value = true
    try {
        // 병렬 API 호출
        val deferredPlaces = async { kakaoService.searchByCategory() }
        val deferredWeather = async { weatherService.currentByLatLng() }

        val places = deferredPlaces.await()
        val weather = deferredWeather.await()

        // GPT 재랭킹 (순차)
        val result = gptUseCase.rerankWithReasons(places, weather)

        _result.value = result
    } catch (e: Exception) {
        _error.value = e.message
    } finally {
        _loading.value = false
    }
}

장점:
✓ 메인 스레드 블로킹 방지
✓ 구조화된 동시성 (Structured Concurrency)
✓ 자동 취소 관리 (viewModelScope)


┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┓
┃              3. Jetpack Compose 선언형 UI                   ┃
┗━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┛

@Composable
fun MainScreen(viewModel: MainViewModel) {
    val filterState by viewModel.filterState.collectAsState()
    val loading by viewModel.loading.collectAsState()

    if (loading) {
        LoadingIndicator()
    } else {
        FilterForm(
            state = filterState,
            onFilterChange = { viewModel.updateFilter(it) },
            onSubmit = { viewModel.generateRoute() }
        )
    }
}

장점:
✓ UI 상태와 자동 동기화
✓ 재사용 가능한 컴포넌트
✓ 미리보기 기능 (@Preview)


┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┓
┃              4. Retrofit2 타입 안전 네트워킹                ┃
┗━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┛

interface KakaoLocalApi {
    @GET("v2/local/search/category.json")
    suspend fun searchByCategory(
        @Query("category_group_code") code: String,
        @Query("x") lng: Double,
        @Query("y") lat: Double,
        @Query("radius") radius: Int = 2000,
        @Query("size") size: Int = 15
    ): KakaoSearchResponse
}

장점:
✓ 자동 JSON 파싱 (Gson)
✓ 타입 안전성
✓ Coroutines 통합 (suspend 함수)


┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┓
┃              5. Kakao Maps SDK 네이티브 통합                ┃
┗━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┛

// Compose에서 Kakao Map 사용
AndroidView(
    factory = { context ->
        MapView(context).apply {
            start(object : MapLifeCycleCallback() {
                override fun onMapDestroy() {}
                override fun onMapError(error: Exception) {}
            })
        }
    },
    update = { mapView ->
        val kakaoMap = mapView.kakaoMap

        // 마커 추가
        places.forEach { place ->
            val marker = kakaoMap.labelManager?.layer?.addLabel(
                LabelOptions.from(LatLng.from(place.lat, place.lng))
                    .setStyles(markerStyle)
            )
        }

        // 폴리라인 추가
        segments.forEach { segment ->
            kakaoMap.routeLineManager?.layer?.addRouteLine(
                RouteLineOptions.from(segment.pathCoordinates)
                    .setStyleIndex(segmentIndex)
            )
        }
    }
)

장점:
✓ 고성능 네이티브 렌더링
✓ 한국 지도 최적화
✓ 다양한 커스터마이징


┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┓
┃              6. Reorderable 드래그 & 드롭                   ┃
┗━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┛

val reorderableState = rememberReorderableLazyListState(
    onMove = { from, to ->
        selectedPlaces = selectedPlaces.toMutableList().apply {
            add(to.index, removeAt(from.index))
        }
    }
)

LazyColumn(
    state = reorderableState.listState,
    modifier = Modifier.reorderable(reorderableState)
) {
    items(selectedPlaces, key = { it.id }) { place ->
        PlaceCard(
            place = place,
            modifier = Modifier.detectReorderAfterLongPress(reorderableState)
        )
    }
}

장점:
✓ 직관적인 UX
✓ 실시간 순서 변경
✓ 애니메이션 자동 처리
```

---

## 📈 9. 성능 최적화 전략

```
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┓
┃                  API 호출 최적화                            ┃
┗━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┛

[전략 1] 병렬 API 호출
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
Before (순차):
  Kakao API (500ms) → Weather API (300ms) → GPT API (3000ms)
  총 소요: 3800ms

After (병렬):
  ┌─ Kakao API (500ms) ────┐
  ├─ Weather API (300ms) ───┤→ GPT API (3000ms)
  └─ 기타 작업 ──────────────┘
  총 소요: 3500ms (300ms 단축)


[전략 2] 결과 캐싱
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
// MainViewModel에서
var lastResult: RecommendationResult? = null

fun generateRoute() {
    if (lastResult != null && !filterChanged) {
        // 캐시된 결과 재사용
        navigateToMap()
        return
    }
    // 새로 API 호출
}


[전략 3] 타임아웃 설정
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
val okHttpClient = OkHttpClient.Builder()
    .connectTimeout(10, TimeUnit.SECONDS)
    .readTimeout(30, TimeUnit.SECONDS)
    .writeTimeout(15, TimeUnit.SECONDS)
    .build()


┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┓
┃                  UI 렌더링 최적화                           ┃
┗━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┛

[전략 1] LazyColumn 사용
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
// 가상화된 리스트 (화면에 보이는 항목만 렌더링)
LazyColumn {
    items(places, key = { it.id }) { place ->
        PlaceCard(place)
    }
}


[전략 2] remember로 재계산 방지
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
@Composable
fun RouteInfo(segments: List<RouteSegment>) {
    val totalDistance = remember(segments) {
        segments.sumOf { it.distanceMeters }
    }
    val totalDuration = remember(segments) {
        segments.sumOf { it.durationSeconds }
    }
}


[전략 3] derivedStateOf로 불필요한 재구성 방지
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
val selectedCount by remember {
    derivedStateOf { selectedPlaces.size }
}


┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┓
┃                  메모리 최적화                              ┃
┗━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┛

[전략 1] 지도 리소스 정리
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
DisposableEffect(Unit) {
    onDispose {
        routeLineManager?.clearRoute()
        labelManager?.clear()
        mapView.finish()
    }
}


[전략 2] 이미지 최적화
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
// 벡터 드로어블 사용 (메모리 절약)
Icon(imageVector = Icons.Default.Place)


[전략 3] 데이터 압축
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
// SharedPreferences 저장 시 불필요한 필드 제거
val lightRoute = SavedRoute(
    id = route.id,
    name = route.name,
    places = route.places.map { it.toLightWeight() }
)
```

---

## 🔒 10. 보안 및 API 키 관리

```
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┓
┃              BuildConfig를 통한 API 키 관리                 ┃
┗━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┛

// local.properties (Git 제외)
kakao.native.app.key=YOUR_KAKAO_NATIVE_KEY
kakao.rest.api.key=YOUR_KAKAO_REST_KEY
openai.api.key=YOUR_OPENAI_KEY
tmap.api.key=YOUR_TMAP_KEY
openweather.api.key=YOUR_WEATHER_KEY

// build.gradle.kts
android {
    defaultConfig {
        buildConfigField("String", "KAKAO_NATIVE_APP_KEY",
            "\"${properties["kakao.native.app.key"]}\"")
        buildConfigField("String", "KAKAO_REST_API_KEY",
            "\"${properties["kakao.rest.api.key"]}\"")
        // ... 나머지 키들
    }
}

// 사용
KakaoLocalService.init(BuildConfig.KAKAO_REST_API_KEY)

장점:
✓ API 키가 소스코드에 노출되지 않음
✓ Git에 커밋되지 않음 (.gitignore에 local.properties 추가)
✓ 팀원마다 다른 키 사용 가능


┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┓
┃                  권한 관리                                  ┃
┗━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┛

// AndroidManifest.xml
<uses-permission android:name="android.permission.INTERNET" />
<uses-permission android:name="android.permission.ACCESS_FINE_LOCATION" />
<uses-permission android:name="android.permission.ACCESS_COARSE_LOCATION" />

// 런타임 권한 요청 (MainActivity)
val locationPermissionRequest = rememberLauncherForActivityResult(
    ActivityResultContracts.RequestMultiplePermissions()
) { permissions ->
    when {
        permissions[Manifest.permission.ACCESS_FINE_LOCATION] == true -> {
            // 정확한 위치 권한 획득
        }
        permissions[Manifest.permission.ACCESS_COARSE_LOCATION] == true -> {
            // 대략적인 위치 권한 획득
        }
        else -> {
            // 권한 거부됨
        }
    }
}
```

---

## 📊 11. 데이터 모델 구조

```
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┓
┃                  핵심 데이터 클래스                         ┃
┗━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┛

data class Place(
    val id: String,              // 고유 ID
    val name: String,            // 장소 이름
    val category: Category,      // 카테고리 (FOOD, CAFE 등)
    val lat: Double,             // 위도
    val lng: Double,             // 경도
    val distanceMeters: Int?,    // 검색 중심으로부터 거리
    val rating: Double?,         // 평점 (0.0~5.0)
    val address: String?,        // 주소
    val phone: String?,          // 전화번호
    val score: Int? = null,      // GPT 점수 (0~100)
    val reason: String? = null   // GPT 추천 이유
)

data class RouteSegment(
    val from: Place,                       // 출발지
    val to: Place,                         // 도착지
    val pathCoordinates: List<LatLng>,     // 경로 좌표 리스트
    val distanceMeters: Int,               // 거리 (미터)
    val durationSeconds: Int,              // 소요 시간 (초)
    val mode: TransportMode = TransportMode.WALK
)

data class SavedRoute(
    val id: String,                        // 타임스탬프 기반 ID
    val name: String,                      // 사용자 지정 이름
    val places: List<Place>,               // 순서대로 방문할 장소
    val routeSegments: List<RouteSegment>, // 구간별 경로 정보
    val createdAt: Long,                   // 생성 시각 (밀리초)
    val totalDistanceMeters: Int,          // 총 거리
    val totalDurationSeconds: Int          // 총 시간
)

data class RecommendationResult(
    val places: List<Place>,               // 추천된 장소 리스트
    val weather: WeatherInfo?,             // 날씨 정보
    val gptReasons: Map<String, String>,   // 장소 ID → 추천 이유
    val aiTopIds: Set<String>,             // AI 상위 추천 ID들
    val topPicks: List<Place>              // 카테고리별 Top 1
)

data class FilterState(
    val region: String = "",               // 지역 (예: "광주")
    val categories: Set<Category> = emptySet(),
    val duration: TripDuration = TripDuration.HALF_DAY,
    val budget: Int = 30000,               // 1인당 예산 (원)
    val companion: Companion = Companion.ALONE
)

enum class Category {
    FOOD,        // 맛집
    CAFE,        // 카페
    PHOTO_SPOT,  // 사진 명소
    CULTURE,     // 문화
    SHOPPING,    // 쇼핑
    HEALING,     // 힐링
    EXPERIENCE,  // 체험
    ACCOMMODATION // 숙소
}

enum class TripDuration {
    HALF_DAY,    // 반나절
    ONE_DAY,     // 하루
    TWO_DAYS,    // 1박2일
    THREE_DAYS   // 2박3일
}

enum class Companion {
    ALONE,       // 혼자
    FRIENDS,     // 친구
    COUPLE,      // 연인
    FAMILY       // 가족
}
```

---

## 🎬 12. 사용 시나리오 예시

```
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┓
┃         시나리오: 광주 친구 여행 (하루 코스)                ┃
┗━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┛

[사용자 입력]
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
지역: 광주
카테고리: 맛집, 카페, 문화
기간: 하루
예산: 50,000원
동행: 친구

↓

[AI 추천 결과] (15개 장소)
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
현재 날씨: 맑음, 22°C

Top Picks:
1. 🍜 광주 송정떡갈비 본점 (맛집)
   "친구와 나눠먹기 좋은 푸짐한 양"

2. ☕ 양림동 빈브라더스 (카페)
   "날씨가 좋아 야외 테라스 추천"

3. 🎨 국립아시아문화전당 (문화)
   "광주 대표 문화 공간, 사진 명소"

기타 추천:
4. 펭귄마을 벽화거리
5. 무등산 입구 카페
6. 충장로 먹거리 골목
... (15개까지)

↓

[사용자 장소 선택] (4개)
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
1. 광주 송정떡갈비 본점 (점심)
2. 양림동 빈브라더스 (오후 간식)
3. 펭귄마을 벽화거리 (산책)
4. 국립아시아문화전당 (저녁 전 관람)

↓

[생성된 경로]
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
총 거리: 5.2km
총 시간: 1시간 12분 (순수 도보)

구간별:
• 송정떡갈비 → 빈브라더스
  850m / 12분 (파란색 선)

• 빈브라더스 → 펭귄마을
  1.2km / 18분 (초록색 선)

• 펭귄마을 → 문화전당
  3.1km / 42분 (노란색 선)

추천 일정:
12:00 - 송정떡갈비 점심
14:00 - 빈브라더스 커피
15:00 - 펭귄마을 산책
16:00 - 문화전당 관람

↓

[루트 저장]
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
이름: "광주 친구 하루 여행 🎨"
저장 완료!

나중에 "루트" 탭에서 언제든 다시 볼 수 있어요.
```

---

## ✅ 프로젝트 완성도 체크리스트

```
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┓
┃                  캡스톤 평가 항목                           ┃
┗━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┛

[✓] 기획 및 설계
    [✓] 명확한 문제 정의 (여행 계획의 어려움)
    [✓] 해결책 제시 (AI 기반 자동 추천)
    [✓] 시스템 아키텍처 설계 (MVVM)
    [✓] UI/UX 설계 (Figma 등)

[✓] 기술 구현
    [✓] Android 네이티브 앱 (Kotlin)
    [✓] 최신 기술 스택 (Compose, Coroutines)
    [✓] 5개 외부 API 통합
    [✓] AI 통합 (OpenAI GPT)
    [✓] 실시간 지도 시각화

[✓] 핵심 기능
    [✓] 스마트 장소 추천
    [✓] 실제 경로 생성 (T-Map)
    [✓] 루트 저장/관리
    [✓] 드래그 드롭 순서 변경
    [✓] 날씨 통합

[✓] 코드 품질
    [✓] MVVM 아키텍처 패턴
    [✓] Repository 패턴
    [✓] 에러 핸들링
    [✓] 코드 주석 및 문서화

[✓] 사용자 경험
    [✓] 직관적인 UI
    [✓] 로딩 상태 표시
    [✓] 에러 메시지
    [✓] 부드러운 애니메이션

[✓] 완성도
    [✓] 처음부터 끝까지 기능 동작
    [✓] 데모 시나리오 준비
    [✓] 발표 자료 (플로우차트)
```

---

## 🎤 데모 발표 시 강조 포인트

```
1️⃣ 기술적 복잡도
   "5개의 외부 API를 통합하여 실시간으로 데이터를 처리합니다"

2️⃣ AI 활용
   "OpenAI GPT로 사용자 컨텍스트를 이해하고 개인화된 추천을 제공합니다"

3️⃣ 실용성
   "실제 T-Map 보행자 경로로 정확한 시간과 거리를 계산합니다"

4️⃣ 사용자 경험
   "3번의 클릭만으로 완성된 여행 경로를 받을 수 있습니다"

5️⃣ 확장 가능성
   "숙소 예약, 교통편 연계, 소셜 공유 등으로 확장 가능합니다"
```

---

**이 자료를 바탕으로 PowerPoint를 만들면 됩니다!**
각 섹션을 슬라이드로 변환하고, 박스와 화살표는
SmartArt나 도형 도구로 시각화하세요. 🎨
